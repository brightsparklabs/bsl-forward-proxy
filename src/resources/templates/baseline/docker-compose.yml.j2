---
##
 # Docker Compose file for running BSL Forward Proxy.
 # ____________________________________________________________________________
 #
 # Created by brightSPARK Labs
 # www.brightsparklabs.com
 ##

services:
  # --------------------------------------------------------------------------
  # INFRASTRUCTURE
  # --------------------------------------------------------------------------

  proxy:
    # Would prefer to use caddy direct, but need the route53 DNS module.
    image: ghcr.io/williamjacksn/caddy-route53
    restart: always
    logging: &logging
      options:
        max-size: '10m'
        max-file: '5'
    volumes:
      - ${TEAM_BSL_GENERATED_CONFIG_DIR:?}/proxy/Caddyfile:/etc/caddy/Caddyfile:ro
      - ${TEAM_BSL_DATA_DIR:?}/proxy/:/data/
    ports:
      - 80:80
      - 443:443

  # --------------------------------------------------------------------------
  # APPLICATIONS
  # --------------------------------------------------------------------------

  landing-page:
    image: b4bz/homer
    restart: always
    logging: *logging
    environment:
      - SUBFOLDER=/landing-page
    volumes:
      - ${TEAM_BSL_GENERATED_CONFIG_DIR:?}/landing-page/config.yml:/www/assets/config.yml:ro

  whoami:
    image: emilevauge/whoami
    restart: always
    logging: *logging
